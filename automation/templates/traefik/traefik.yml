---
# ============================================================================
# Traefik v3.6 Static Configuration
# ============================================================================
# This file defines Traefik's core behavior and entry points
# Dynamic configuration (routes, services) is handled via Docker labels
# ============================================================================

# Global configuration
global:
  checkNewVersion: true
  sendAnonymousUsage: false

# API and Dashboard
api:
  dashboard: true
  insecure: false  # Dashboard secured via Traefik itself

# Entry Points (ports Traefik listens on)
entryPoints:
  web:
    address: ":80"
    # HTTP to HTTPS redirect handled via labels in docker-compose.yml
  
  websecure:
    address: ":443"
    http:
      tls:
        certResolver: cloudflare
        domains:
          # Wildcard certificates for all managed domains
          - main: "nixsysadmin.io"
            sans:
              - "*.nixsysadmin.io"
          - main: "sigtom.com"
            sans:
              - "*.sigtom.com"
          - main: "sigtom.dev"
            sans:
              - "*.sigtom.dev"
          - main: "sigtom.info"
            sans:
              - "*.sigtom.info"
          - main: "sigtom.io"
            sans:
              - "*.sigtom.io"
          - main: "sigtomtech.com"
            sans:
              - "*.sigtomtech.com"
          - main: "tecnixsystems.com"
            sans:
              - "*.tecnixsystems.com"

# Certificate Resolvers (Let's Encrypt)
certificatesResolvers:
  cloudflare:
    acme:
      email: "admin@sigtom.dev"  # CHANGE THIS to your email
      storage: /letsencrypt/acme.json
      dnsChallenge:
        provider: cloudflare
        delayBeforeCheck: 30
        resolvers:
          - "1.1.1.1:53"
          - "8.8.8.8:53"

# Providers
providers:
  # Docker provider - auto-discover containers
  docker:
    endpoint: "unix:///var/run/docker.sock"
    exposedByDefault: false  # Only expose containers with traefik.enable=true
    network: traefik-proxy
    watch: true
  
  # File provider - for manual configuration (VMs, external services)
  file:
    directory: /config
    watch: true

# Logging
log:
  level: INFO  # DEBUG, INFO, WARN, ERROR
  filePath: /logs/traefik.log
  format: json

# Access logs
accessLog:
  filePath: /logs/access.log
  format: json
  bufferingSize: 100
