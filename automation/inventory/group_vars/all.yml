# Proxmox API Credentials (will be pulled from env)
pve_api_user: "sre-bot@pve"
pve_api_token_id: "sre-token"
pve_api_token_secret: "{{ lookup('env', 'PROXMOX_SRE_BOT_API_TOKEN') }}"

# Global SSH Keys to inject
global_ssh_keys:
  - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKfMMLr0UIUkpVUghSd4FkVUteUzFOCP1WknScNOrl8u sigtom@localhost.localdomain"
  - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILPyc7oAxzmaymnrZWblYRbTH/hOd+OPaQStsMNi/3bU sigtom@localhost.localdomain"
  - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEEJZzVG6rJ1TLR0LD2Rf1F/Wd6LdSEa9FoEvcdTqDRd sigtom@ilum"
  - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIRFptKwqZg4xn2/xoq4JWe8QAUrBzxMUt+m07Lmprv6 sigtom@vuff.sigtom.io"

# Proxmox Storage Backends - Per-node storage configuration
proxmox_storage_backends:
  wow-prox1:
    vm_storage: "TSVMDS01"
    lxc_storage: "TSVMDS01"
    iso_storage: "local"
    template_storage: "TSVMDS01"
    backup_storage: "TSVMDS01"

# Default storage backend (can be overridden per-host)
default_vm_storage: "TSVMDS01"
default_lxc_storage: "TSVMDS01"

# VM OS Templates - Maps OS types to Proxmox template VMIDs
vm_templates:
  fedora43:
    vmid: 9025
    name: "fedora-43-cloudinit"
    default_user: "fedora"
    description: "Fedora 43 Cloud Image"
  rhel9:
    vmid: 9026
    name: "rhel-9-cloudinit"
    default_user: "cloud-user"
    description: "Red Hat Enterprise Linux 9"
  rhel10:
    vmid: 9001
    name: "wow-rhel10-temp-cloud-init"
    default_user: "cloud-user"
    description: "Red Hat Enterprise Linux 10"
  ubuntu22:
    vmid: 9022
    name: "ubuntu-22.04-cloudinit"
    default_user: "ubuntu"
    description: "Ubuntu 22.04 LTS (Jammy)"
  ubuntu24:
    vmid: 9024
    name: "ubuntu-24.04-cloudinit"
    default_user: "ubuntu"
    description: "Ubuntu 24.04 LTS (Noble)"
  ubuntu25:
    vmid: 9029
    name: "ubuntu-25.04-cloudinit"
    default_user: "ubuntu"
    description: "Ubuntu 25.04 (Plucky)"

# LXC OS Templates - Maps OS types to template filenames
lxc_templates:
  ubuntu22:
    filename: "ubuntu-22.04-standard_22.04-1_amd64.tar.zst"
    default_user: "root"
    description: "Ubuntu 22.04 LTS Container"
  ubuntu24:
    filename: "ubuntu-24.04-standard_24.04-2_amd64.tar.zst"
    default_user: "root"
    description: "Ubuntu 24.04 LTS Container"
  ubuntu25:
    filename: "ubuntu-25.04-standard_25.04-1_amd64.tar.zst"
    default_user: "root"
    description: "Ubuntu 25.04 Container"
  debian12:
    filename: "debian-12-standard_12.7-1_amd64.tar.zst"
    default_user: "root"
    description: "Debian 12 (Bookworm) Container"

# SSH Connection Defaults
ssh_connection_defaults:
  key_file: "~/.ssh/id_pfsense_sre"
  user: "root"  # Default for Proxmox API operations
  options:
    - "BatchMode=yes"
    - "StrictHostKeyChecking=no"
    - "ConnectTimeout=10"

# Proxmox API Defaults
proxmox_api_defaults:
  port: 8006
  validate_certs: false
  timeout: 30
  retry_count: 3
  retry_delay: 5

# Provisioning Timeouts (all in seconds)
provisioning_timeouts:
  # Clone/Create operations
  vm_clone_wait: 10
  lxc_create_wait: 20

  # Boot operations
  vm_boot_wait: 30
  lxc_boot_wait: 15

  # Service readiness checks
  ssh_ready_timeout: 120
  http_ready_timeout: 60
  https_ready_timeout: 120
  qemu_agent_timeout: 60

  # API operations
  api_timeout: 30
  api_retry_count: 10
  api_retry_delay: 10

# Cloud-Init Defaults
cloudinit_defaults:
  timezone: "America/New_York"
  locale: "en_US.UTF-8"
  package_upgrade: false  # Don't auto-upgrade during provisioning
  packages:
    - qemu-guest-agent
    - vim
    - curl
    - wget
    - git
    - htop
    - net-tools
  ssh_pwauth: false  # Disable password authentication
  disable_root: false  # Allow root with key-only auth

# ============================================================================
# Phase 3C: Snapshot/Backup Policies
# ============================================================================

# Snapshot policies for VMs and LXC containers
snapshot_policies:
  # No snapshots
  none:
    enabled: false

  # Default - pre-provision snapshot only (safety net)
  default:
    pre_provision:
      enabled: true
      retention_hours: 24
      vmstate: false
      description: "Pre-provisioning snapshot"
    post_provision:
      enabled: false

  # Standard - pre + post provision snapshots
  standard:
    pre_provision:
      enabled: true
      retention_hours: 48
      vmstate: false
      description: "Pre-provisioning snapshot"
    post_provision:
      enabled: true
      retention_hours: 168  # 7 days
      vmstate: false
      description: "Post-provisioning baseline"

  # Production - pre + post + auto cleanup
  production:
    pre_provision:
      enabled: true
      retention_hours: 168  # 7 days
      vmstate: false
    post_provision:
      enabled: true
      retention_hours: 720  # 30 days
      vmstate: false
    auto_cleanup:
      enabled: true
      schedule: "daily"  # Run cleanup daily

# Default snapshot policy (can be overridden per-host)
default_snapshot_policy: default

# Network Profiles - Standardized network configurations
network_profiles:
  # Primary application network (Native VLAN on vmbr0)
  apps:
    bridge: vmbr0
    vlan: null  # Native/untagged
    subnet: "172.16.100.0/24"
    gateway: 172.16.100.1
    dns_servers:
      - 172.16.100.2   # wow-pihole1 (primary)
      - 172.16.110.100 # TrueNAS Pi-hole (secondary)
    ntp_servers:
      - 10.1.1.1       # pfSense NTP
    description: "Primary application network for VMs and containers"
    default: true  # Default network if not specified

  # Proxmox management plane (VLAN 110 - RESTRICTED)
  proxmox-mgmt:
    bridge: vmbr0
    vlan: 110
    subnet: "172.16.110.0/24"
    gateway: 172.16.110.1
    dns_servers:
      - 172.16.100.2
      - 172.16.110.100
    ntp_servers:
      - 10.1.1.1
    description: "Proxmox management plane - infrastructure critical systems only"
    restricted: true  # Requires justification

# VM T-shirt Sizes (Matches Nautobot config context metadata)

vm_tshirt_sizes:
  small:
    cores: 1
    memory: 512
    disk: 8
    description: "Lightweight services, proxies"
  medium:
    cores: 2
    memory: 2048
    disk: 20
    description: "Docker hosts, web applications"
  large:
    cores: 4
    memory: 4096
    disk: 50
    description: "Multi-container stacks"
  xlarge:
    cores: 8
    memory: 8192
    disk: 100
    description: "Heavy workloads"

# LXC T-shirt Sizes (Matches Nautobot config context metadata)
lxc_tshirt_sizes:
  small:
    cores: 1
    memory: 512
    disk: 8
    description: "Lightweight services, proxies"
  medium:
    cores: 2
    memory: 2048
    disk: 20
    description: "Docker hosts, web applications"
  large:
    cores: 4
    memory: 4096
    disk: 50
    description: "Multi-container stacks"
  xlarge:
    cores: 8
    memory: 8192
    disk: 100
    description: "Heavy workloads"
